#include "database_connection.h"

DataBaseConnection::DataBaseConnection(const std::string &user, const std::string &password,
                                       const std::string &port, const std::string &host, const std::string &dbname) :
        user(user), password(password), port(port), host(host), dbname(dbname) {
    
    if (user == "" || password == "" || port == "" || host == "" || dbname == "") {
        std::cout << "Error :  Check database configuration, not all settings filled\n";
        throw std::bad_alloc();
    }
    
    std::string str_query = fmt::format("postgresql://{0}:{1}@{2}:{3}/{4}", user, password, host, port, dbname);

    try {
        conn = new pqxx::connection(str_query);
    } catch (const pqxx::sql_error &e) {
        std::cout << e.what() << "\n";
        throw &e;
    }

}

DataBaseConnection::~DataBaseConnection() {
    conn->disconnect();
    delete conn;
}

pqxx::connection *DataBaseConnection::get_connection() {
    return conn;
}

std::string DataBaseConnection::get_user_name() {
    return user;
}

std::string DataBaseConnection::get_password() {
    return password;
}

std::string DataBaseConnection::get_port() {
    return port;
}

std::string DataBaseConnection::get_dbname() {
    return dbname;
}

std::string DataBaseConnection::get_host() {
    return host;
}
